# DB 심화

## DB 관계 종류

 - 1:1
   - A 테이블 하나의 레코드가, B 테이블의 하나의 레코드와 연결된 경우
   - ex) 각 사용자는 하나의 프로필을 가짐(사용자:프로필 = 1:1)
   - ex2) 각 주문은 하나의 결제 정보를 가짐(주문:정보 = 1:1)

 - 1:N
   - A 테이블 하나의 레코드가 B 테이블의 여러 레코드와 연결된 경우
   - ex) 하나의 게시글에 여러 개의 댓글을 작성 가능(게시글:댓글 = 1:N)
   - ex2) 우리 반에는 여러 교육생들이 있다(반:교육생 = 1:N)

 - M:N
   - A 테이블의 여러 레코드가 B 테이블의 여러 레코드와 연결된 경우
   - ex) 한 게시글에 여러 명이 좋아요를 누를 수 있음, 한 명이 여러 개의 게시글에 좋아요를 누를 수 있다. (게시글:유저 = M:N)
   - ex2) 여러 학생이 여러 과목을 듣는다(학생:과목 = M:N)

## DB 에서 KEY 란 ?

 - 데이터베이스 테이블에서 특정 레코드를 고유하게 식별할 수 있는 필드 또는 필드 집합
   - 데이터를 검색하거나 조작할 때, KEY 값을 사용해서 특정 레코드를 식별

 - KEY의 종류

   1. 기본키(Primary key)
    - 테이블 내에서 각각의 레코드를 식별하는 역할을 수행하는 필드
    - 유일한(중복되지 않고) NULL 값을 가질 수 없는 유일한 값

   2. 외래키(Foreign key)
    - 하나의 테이블에서 다른 테이블의 기본키(PK)를 참조하는 필드
    - 두 개 이상의 테이블을 연결할 때 사용
    - 반드시 사용해야 하나?
      - 개발자의 실수를 막기 위해서(데이터의 무결성을 유지하기 위해) DB가 "제약 조건"을 거는 것
    - 장점
      - 데이터의 무결성이 보장된다(즉, 에러가 없다!)
    - 단점
      - 체크해야할 사항이 많아짐 => 리소스(오버헤드)가 더 발생

   [참고]추가로 공부
   3. 후보키
   4. 복합키
   5. 대체키
   6. 슈퍼키

## 정규화(테이블 분리하기)

 - 테이블의 구조를 더 좋은 구조로 바꾸는 과정
   - 테이블을 나누거나, 합치는 과정
 - 목표
   - 데이터의 중복 최소화
   - 데이터의 무결성을 보장하기 위함
 - 총 6단계 정규형이 존재함
 - 기본 정규형(4개)
   - 제1정규형(1NF)
     - 모든 속성이 원자값(Atomic Value)을 가지도록 테이블을 구성하는 것
     - 즉, 각 속성이 하나의 값만을 가지도록 하는 것
     - 목표 : 테이블 간 중복되는 데이터가 없도록 하기 위함
   - 제2정규형(2NF)
     - 테이블이 1NF 이어야 한다.
     - 테이블 내의 모든 컬럼은 해당 테이블의 주식별자(PK)에만 종속되어야 한다.
   - 제3정규형(3NF)
   - BCNF(보이스/코드 정규형)
 - 고급 정규형(2개)

## JOIN

 - CROSS JOIN
   - 두 테이블의 모든 가능한 조합을 선택함
 - INNER JOIN
   - 두 테이블에서 일치하는 값을 가진 행들만 선택
   - NULL 값이 존재하면 사라짐
 - LEFT JOIN
   - 왼쪽 테이블의 모든 행과 오른쪽 테이블에서 일치하는 값을 가진 행을 선택
   - 일치하는 값이 없다면 NULL 값을 가진다.

## Many to on relationships

 - 한 테이블의 0개 이상의 레코드가 다른 테이블의 레코드 한 개와 관련된 관계
 - comment(N) : article(1) 관계 (N:1)
 - N쪽이 외래키를 가지고 있어야 한다.

### ForeignKey()

 - N:1 관계 설정 모델 필드

## 댓글 모델 정의

 - ForeignKey() 클래스의 인스턴스 이름은 참조하는 모델 클래스 이름의 단수형으로 작성하는 것을 권장
 - ForeignKey 클래스를 작성하는 위치와 관계없이 외래 키는 테이블 필드 마지막에 생성됨
 - ForeignKey(to, on_delete)
   - 외래 키가 참조하는 객체(1)가 사라졌을 때, 외래 키를 가진 객체(N)를 어떻게 처리할 지를 정의하는 

### 역참조 사용 예시

 - article.comment_set.all() : 모델 인스턴스 + related manager(역참조 이름) + QuerySet API
 - related manager : N:1 혹은 M:N 관계에서 역참조 시 사용하는 매니저